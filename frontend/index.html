<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="google-site-verification" content="0T_-BqWYQjpc7CKNl-4284ugepEajJiz3aG4XiPiqbo" />
  <meta charset="UTF-8" />
  <title>Group Chat</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .screen { display: none; }
    .screen.active { display: block; }
  </style>
</head>
<body>

<!-- ðŸŸ© Sign Up Screen -->
<div id="signup-screen" class="screen active">
  <h2>ðŸŸ© Sign Up</h2>
  <input id="signup-username" placeholder="Username" /> <br>
  <input id="signup-password" type="password" placeholder="Password" /> <br>
  <input id="signup-confirm-password" type="password" placeholder="Confirm Password" /> <br>
  <label>
    <input type="checkbox" id="signup-show-password" onclick="togglePassword('signup-password', 'signup-confirm-password', this)">
    Show Password
  </label>
  <button onclick="signUp()">Sign Up</button>
  <p>Already have an account? <button onclick="showScreen('signin-screen')">Sign In</button></p>
</div>

<!-- ðŸŸ¦ Sign In Screen -->
<div id="signin-screen" class="screen">
  <h2>ðŸŸ¦ Sign In</h2>
  <input id="signin-username" placeholder="Username" /> <br>
  <input id="signin-password" type="password" placeholder="Password" /> <br>
  <label>
    <input type="checkbox" id="signin-show-password" onclick="togglePassword('signin-password', null, this)">
    Show Password
  </label>
  <button onclick="signIn()">Sign In</button>
  <p>New here? <button onclick="showScreen('signup-screen')">Sign Up</button></p>
</div>

<!-- ðŸŸ¨ Chat Screen -->
<div id="chat-screen" class="screen">
  <h2>ðŸ’¬ Group Chat</h2>
  <button id="darkModeToggle">ðŸŒ™ Toggle Dark Mode</button>
  <h3>Online Users</h3>
<ul id="online-users"></ul>

<p id="typing-indicator" style="color: gray; font-style: italic;"></p>
  <h3>Messages</h3>
  <ul id="messages"></ul>
  <form onsubmit="sendMessage(); return false;">
    <input id="message" autocomplete="off" placeholder="Type your message..." />
    <button type="submit">Send</button>
  </form>
</div>

<script src="/socket.io/socket.io.js"></script>
<script type="module" src="client.js"></script>

<script>
  const toggle = document.getElementById('darkModeToggle');

//already declared in client.js

  // Get saved theme from localStorage OR cookie OR URL params
  // Returns true for dark mode, false for light mode
document.addEventListener('DOMContentLoaded', function() {
  function getSavedTheme() {
    try {
      if (localStorage.getItem('dark-mode') !== null) {
        return localStorage.getItem('dark-mode') === 'true';
      }
    } catch (e) {
      // localStorage unavailable
    }
    const params = new URLSearchParams(window.location.search);
    if (params.has('theme')) {
      return params.get('theme') === 'dark';
    }
    const match = document.cookie.match(/theme=(dark|light)/);
    return match ? match[1] === 'dark' : false;
  }

  // Save theme to localStorage and cookies
  function saveTheme(isDark) {
    try {
      localStorage.setItem('dark-mode', isDark);
    } catch (e) {
      // Ignore localStorage errors
    }
    document.cookie = `theme=${isDark ? 'dark' : 'light'}; path=/; max-age=31536000`; // 1 year
  }

  // Apply saved theme on load
  if (getSavedTheme()) {
    document.body.classList.add('dark-mode');
  }

  // Toggle button click
  toggle.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    saveTheme(document.body.classList.contains('dark-mode'));
  });
});

// Show the Password toggle checkbox

function togglePassword(id1, id2, checkbox) {
  const field1 = document.getElementById(id1);
  if (field1) field1.type = checkbox.checked ? "text" : "password";
  if (id2) {
    const field2 = document.getElementById(id2);
    if (field2) field2.type = checkbox.checked ? "text" : "password";
  }
}
</script>

</body>
</html>
